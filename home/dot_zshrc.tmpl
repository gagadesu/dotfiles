# zmodload zsh/zprof
{{- if eq .chezmoi.os "darwin" }}
# Fig pre block. Keep at the top of this file.
[[ -f "$HOME/.fig/shell/zshrc.pre.zsh" ]] && builtin source "$HOME/.fig/shell/zshrc.pre.zsh"
# Fig pre block. Keep at the top of this file.

# Proxy
export https_proxy=http://127.0.0.1:6152;export http_proxy=http://127.0.0.1:6152;export all_proxy=socks5://127.0.0.1:6153

# zsh
setopt AUTO_CD
setopt EXTENDED_GLOB

# path
export PATH="/opt/homebrew/bin:/opt/homebrew/sbin:/opt/homebrew/opt/gnu-sed/libexec/gnubin:/opt/homebrew/opt/curl/bin:$PATH"

alias brew="env PATH=\"${PATH/\/Users\/${USER}\/\.pyenv\/shims:/}\" brew"
alias bi='brew install'
alias bd='brew update'
alias bg='brew upgrade'
alias ci='brew install --cask'
alias bui='brew uninstall'
alias cui='brew uninstall --cask'
alias bcu='brew cu'
alias bs='brew search'
alias bl='brew leaves'
alias budg='brew update && brew upgrade'
alias bc='brew cleanup'
alias bdc='brew doctor'
alias binf='brew info'
alias bo='brew outdated'
alias bdp='brew deps'
alias bdpt='brew deps --tree'

# curl
export LDFLAGS="-L/opt/homebrew/opt/curl/lib"
export CPPFLAGS="-I/opt/homebrew/opt/curl/include"
export PKG_CONFIG_PATH="/opt/homebrew/opt/curl/lib/pkgconfig"

# 1Password
export SSH_AUTH_SOCK=~/Library/Group\ Containers/2BUA8C4S2C.com.1password/t/agent.sock

# Directory
hash -d dld=~/Downloads
hash -d dev=~/Developer
hash -d dbx=~/Dropbox
hash -d sur=~/Library/Mobile\ Documents/iCloud~com~nssurge~inc/Documents
hash -d conf=$XDG_CONFIG_HOME
hash -d nvl=$XDG_DATA_HOME/chezmoi/dot_config/nvim/lua/user
hash -d cz=$XDG_DATA_HOME/chezmoi/
perm () {
  stat -f "%Sp %OLp %N" $1
}

# Network
alias nq='networkQuality'
alias nqcf='npx speed-cloudflare-cli'
alias nqf='npx fast-cli'
ping () {
  /sbin/ping -c 5 $1 $2 $3 | nali
}
dig () {
  dog $1 $2 $3 | nali
}
ding () {
  dog $1 @1.1.1.1 | cut -d' ' -f6 | xargs ping -c 5 | nali
}

# Password
source $HOME/.config/op/plugins.sh
alias p1p="pass show -c 1Password"
alias enc="gpg -r 8F7941D4 -e"

# Docker
alias d="docker"
# export DOCKER_HOST='tcp://127.0.0.1:2375'
# export DOCKER_HOST=unix://$HOME/.lima/docker/sock/docker.sock
# export DOCKER_HOST=unix://$HOME/.colima/default/docker.sock

# Lima
# export LIMA_SHELL=/usr/bin/zsh
# export LIMA_WORKDIR=/home/gagadesu.linux
alias lin="lima nerdctl"
alias lil="limactl"
alias clm="colima"

# R
export R_HOME=/Library/Frameworks/R.framework/Resources

# Tailscale
alias ts="/Applications/Tailscale.app/Contents/MacOS/Tailscale"

# Yabai
alias yabairl='launchctl kickstart -k "gui/${UID}/homebrew.mxcl.yabai"'
alias yabairc='nvim ~/.config/yabai/yabairc'

# Go
export GOPATH=$HOME/.go
export PATH=$PATH:$GOPATH/bin

# Java
export JENV_ROOT="$HOME/.jenv"
if [ -d "${JENV_ROOT}" ]; then
    export PATH="$JENV_ROOT/bin:$PATH"
    eval "$(jenv init - --no-rehash)"
    (jenv rehash &) 2> /dev/null
fi

# NodeJS
export N_PREFIX=$HOME/.n
export PATH=$N_PREFIX/bin:$PATH

# Python
export PYENV_ROOT="$HOME/.pyenv"
command -v pyenv >/dev/null || export PATH="$PYENV_ROOT/bin:$PATH"
eval "$(pyenv init -)"
alias py3="python3"
alias py2="python2"

# Rust
. "$HOME/.cargo/env"

# Ruby
eval "$(rbenv init - zsh)"

# Github
export GPG_TTY=$(tty)
gpgconf --launch gpg-agent

# Misc
export CLICOLOR=1
export LSCOLORS=Gxfxcxdxbxegedabagacad
alias rud="cd ~/Developer/rime-ice && git pull origin main"
alias asb="ansible"
alias apb="ansible-playbook"
{{- end}}

export TERM=xterm-256color
export GREP_OPTIONS='--color=auto'
export GREP_COLOR='3;33'

# History
HISTSIZE=1000
SAVEHIST=1000
HISTFILE=$XDG_CACHE_HOME/zsh/zsh_history
HIST_STAMPS="yyyy-mm-dd"

# Znap
[[ -f $HOME/.znap/zsh-snap/znap.zsh ]] ||
    git clone --depth 1 -- \
        https://github.com/marlonrichert/zsh-snap.git $HOME/.znap/zsh-snap
source $HOME/.znap/zsh-snap/znap.zsh
znap source zsh-users/zsh-autosuggestions
znap source zsh-users/zsh-completions
znap source ael-code/zsh-colored-man-pages
{{- if eq .chezmoi.os "darwin" }}
znap source thirteen37/fzf-brew
{{- end }}
znap source jeffreytse/zsh-vi-mode
#znap source zsh-users/zsh-syntax-highlighting
znap source zdharma-continuum/fast-syntax-highlighting
unset ZSH_AUTOSUGGEST_USE_ASYNC
fpath=($HOME/.znap/zsh-completions/src $fpath)
autoload -Uz compinit && compinit

# Starship
#znap eval starship 'starship init zsh --print-full-init'
#znap prompt starship
export STARSHIP_CONFIG=$HOME/.starship.toml
eval "$(starship init zsh)"

# General
alias h="tldr" 
alias nv='nvim'
alias lv='lvim'
alias -g ...='../..'
alias -g ....='../../..'
alias -g .....='../../../..'
alias -g ......='../../../../..'
alias dus="du -smh * | sort -nr" # sort by size
alias lh='ls -d .*' # show hidden files/directories only
alias tgz='tar -czf' # compress file
alias ugz='tar -xzf' # decompress file
alias l="eza --sort Name"
alias ll="eza --sort Name --long --octal-permissions --hyperlink"
alias la="eza --sort Name --long --octal-permissions --hyperlink --all"
alias lt="eza --sort Name --long --octal-permissions --hyperlink --tree"
alias lta="eza --sort Name --long --octal-permissions --hyperlink --tree --all"

# Delete Apple System Logs
alias dasl="sudo rm -rf /private/var/log/asl/*.asl"

# Chezmoi
alias cz="chezmoi"

# zoxide
eval "$(zoxide init zsh)"
alias zz="z -"

# fzf
[ -f ~/.fzf.zsh ] && source ~/.fzf.zsh
#export FZF_DEFAULT_COMMAND='vim $(fzf)'
export FZF_DEFAULT_OPTS='--reverse --border'

# Functions
source $HOME/.zsh_functions

{{- if eq .chezmoi.os "darwin" }}
# # >>> conda initialize >>>
# # !! Contents within this block are managed by 'conda init' !!
# __conda_setup="$('/opt/homebrew/Caskroom/miniforge/base/bin/conda' 'shell.zsh' 'hook' 2> /dev/null)"
# if [ $? -eq 0 ]; then
#     eval "$__conda_setup"
# else
#     if [ -f "/opt/homebrew/Caskroom/miniforge/base/etc/profile.d/conda.sh" ]; then
#         . "/opt/homebrew/Caskroom/miniforge/base/etc/profile.d/conda.sh"
#     else
#         export PATH="/opt/homebrew/Caskroom/miniforge/base/bin:$PATH"
#     fi
# fi
# unset __conda_setup
# # <<< conda initialize <<<

# Fig post block. Keep at the bottom of this file.
[[ -f "$HOME/.fig/shell/zshrc.post.zsh" ]] && builtin source "$HOME/.fig/shell/zshrc.post.zsh"
{{- end }}
# zprof
